#!/bin/bash

SSH_CONFIG=$(ls ~/.ssh/config)

if [ "$1" = "-e" ]
then
	vim $0
	exit
fi

if [ "$1" = "-l" ]
then
	grep -o -E "Host .*" $SSH_CONFIG | sed 's#Host\ ##'
	exit
fi

if [ $# -lt 1 ] || [ "$1" = "info" ]
then
	echo "Usage: ${0##/*/} MACHINE [-d]"
	echo "Usage: ${0##/*/} info [pattern]"
	echo "Usage: ${0##/*/} [-l] #list"
	echo "Usage: ${0##/*/} [-e]"
	
	# List of HostNames
	# grep 'Host ' $SSH_CONFIG | sed 's#Host\ \([a-z0-9\.]*\)#\1#g' | implode
	
	for i in $(grep "Host .*$2" -n $SSH_CONFIG | sed 's#\([0-9]*\):.*#\1#')
	do
		sed -n $i,$(expr $i + 3)p $SSH_CONFIG \
			| sed 's#.*\ \([^\ ]*\)#\1#g' \
			| xargs printf '%s %s %s %s\n'
	done | column -t
	exit
fi

usermachine=$1

if [ "$usermachine" = "local" ]
then
	screen -R -d -S chernjie
elif [ "$2" = "-d" ]
then
	ssh -v $usermachine
else
	ssh -v $usermachine -t screen -R -d -S chernjie
fi
